---
title: "Introduction to Mathematical Optimization and Mixed-Integer Programming"
author: "Yuanzhe(Roger) Li"
date: "11/12/2019"
output:
  beamer_presentation: 
    colortheme: seagull
    fonttheme: professionalfonts
    theme: Rochester
urlcolor: blue
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
options(tinytex.verbose = TRUE)
library(dplyr)
library(ggplot2)
library(ompr)
library(ompr.roi)
library(ROI.plugin.glpk)
```

## R Markdown

This is an R Markdown presentation. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document.

## Overview

- Mathematical Optimization
- Mixed-Integer Programs
  - Examples 

## Overview of Mathematical Optimization


## Mixed-Integer Programs

$$\begin{aligned}
\max \quad & f(x)\\
s.t. \quad & g(x) \leq 0 \\
& x \in \mathbb{R} \times \mathbb{Z}
\end{aligned}$$



## Portfolio Optimization


## Traveling Salesman Problem
- [TSP wikipedia page](https://en.wikipedia.org/wiki/Travelling_salesman_problem)

> The travelling salesman problem (TSP) asks the following question: Given a list of cities and the distances between each pair of cities, what is the shortest possible route that visits each city exactly once and returns to the origin city?

```{r tsp_setup, fig.width=3.5, fig.height=1.8, fig.align='center'}
# number of cities
n <- 10
# boundary of euclidean space
max_x <- 500
max_y <- 250
set.seed(9102)

cities <- data.frame(
  id = 1:n
  ,x = runif(n, max = max_x)
  ,y = runif(n, max = max_y)
)

# Add distances and dist_fun
distance <- as.matrix(
  stats::dist(select(cities, x, y)
  ,diag = TRUE
  ,upper = TRUE)
  )
dist_fun <- function(i, j) {
  vapply(seq_along(i), function(k) distance[i[k], j[k]], numeric(1L))
}

# Draw an example route
route <- c(5,9,10,3,4,1,2,6,8,7,5)
random_path <- data.frame(
  trip_id = lapply(seq_along(1:10), function(x) rep(x,2)) %>% unlist
  ,cid = c(
    route[1]
    ,lapply(route[2:10], function(x) rep(x,2)) %>% unlist(.)
    ,route[11]
    )
  ) %>%
  dplyr::left_join(cities, by = c("cid"="id"))

total_dist <- random_path %>% 
  dplyr::group_by(trip_id) %>% 
  dplyr::summarise(origin = unique(cid)[1], destination=unique(cid)[2]) %>%
  dplyr::mutate(distance=dist_fun(origin, destination)) %>%
  dplyr::pull(distance) %>%
  sum(.)
  



# Plot the example cities and route
ggplot(cities, aes(x, y),label = id) + 
  geom_point() + 
  geom_text(aes(label=id),color = "blue",hjust=1.5, vjust=0.5, size =3) + 
  annotate(
    "text"
    ,label=paste0("Random path with total distance = ", round(total_dist,2))
    ,x= 250, y=225, color = "blue", size=2
    ) +
  geom_line(data = random_path, aes(group=trip_id), linetype="dashed", color="grey") +  
  xlab("x coordinate") + 
  ylab("y coordinate") + 
  xlim(0,500) + ylim(0,250) + 
  ggtitle("TSP example with 10 cities") +
  theme_light() +
  theme(plot.title = element_text(size = 10, face = "bold"))
```

## 
Add distance to the figure
